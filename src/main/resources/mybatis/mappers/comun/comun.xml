<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="org.apz.xxx.dao.ComunDao"> 
 
	<!-- ..................................... -->
	<!-- 	getFechaActual			  		   -->
	<!-- ..................................... -->
	<select id="getFechaActual"
			resultType="java.util.Date">
    	
    	    SELECT NOW() FROM DUAL
			
    </select>
    
    <!-- ..................................... -->
	<!-- 	getParametrosDatabase			   -->
	<!-- ..................................... -->
	<select id="getParametrosDatabase"
			resultType="java.util.HashMap">
    	
    		(
			  	SELECT 
			    	'NUMERO DE TABLAS' AS NOMBRE,
			     	(SELECT TO_CHAR(COUNT(*)) FROM USER_TABLES WHERE TABLE_NAME LIKE 'FORM_%') AS VALOR
			  	FROM DUAL A
			)
    		
    		UNION
    		
    		(
    			SELECT 
				  'TAMAÃ‘O TABLAS' AS NOMBRE,
				  SUM(bytes/1024/1024) || ' MB' AS VALOR
				FROM 
				  user_segments 
				WHERE 
				  SEGMENT_NAME IN (
				    SELECT TABLE_NAME FROM user_tables WHERE table_name LIKE 'FORM_%'
				  )
    		)
    		
    		UNION
    		
    		(
	    	    SELECT  
	    	    	PARAMETER AS NOMBRE,
	    			VALUE AS VALOR
	    		FROM 
	    			<![CDATA[V$NLS_PARAMETERS]]>
	    	)
			
    </select>
    
    
    <!-- ..................................... -->
	<!-- 	getUsuarioDatabase				   -->
	<!-- ..................................... -->
	<select id="getUsuarioDatabase"
			resultType="java.lang.String">
    	
    		select USER from dual
			
    </select>
    
    <!-- ..................................... -->
	<!-- 	getPrivilegiosUsuario			   -->
	<!-- ..................................... -->
	<select id="getPrivilegiosUsuario"
			resultType="java.util.HashMap">
    	
    		SELECT 
			  OWNER || ' - ' ||  TABLE_NAME AS NOMBRE,
			  RTRIM(XMLAGG(XMLELEMENT(USER_TAB_PRIVS, privilege ||',')).EXTRACT('//text()'), ',') AS VALOR
			FROM 
			  USER_TAB_PRIVS 
			WHERE 
			  grantee = (select USER from dual) 
			GROUP BY 
			  OWNER,TABLE_NAME 
			ORDER BY 
			  OWNER, TABLE_NAME
			
    </select>
   
</mapper>